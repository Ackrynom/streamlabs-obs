<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Regression preview</title>
  <script src="https://rawgit.com/vuejs/vue/dev/dist/vue.js" type="application/javascript"></script>
</head>
<body>

<div id="app">
  <div class="filters">

    <div v-for="(filter, paramName) of state.config.configs" class="filter">
      <h3>{{ paramName }}</h3>
      <label v-for="(filterParam.options, ind) of filter">
        <input type="checkbox" v-model="filters[paramName][ind]">
        {{ JSON.stringify(filterParam) }}
      </label>
    </div>

    <ul class="stats">
      <li>Total: {{ state.totalScreens }}</li>
      <li>Changed: {{ state.changedScreens }}</li>
      <li>New: {{ state.newScreens }}</li>
    </ul>

  </div>
  <div class="regressions">
    <div
        class="regression"
        :class="{'regression-new': regression.isNew }"
        v-for="(regression, ind) of state.regressions"
        v-if="canShow(regression)"
    >

      <span v-if="regression.isNew" class="new">NEW</span>
      {{ ind }}
      <pre>({{ JSON.stringify(regression.params) }})</pre>
      <table width="100%">
        <tr>
          <td >
            <a :href="'../../' + regression.branchImage" target="_blank">
              <img :src="'../../' + regression.branchImage" >
            </a>
          </td>
          <td >
            <a :href="'../../' + regression.baseImage"  target="_blank" v-if="!regression.isNew">
              <img :src="'../../' + regression.baseImage" >
            </a>
          </td>
          <td>
            <a :href="'../../' + regression.diffImage"  target="_blank" v-if="!regression.isNew">
              <img :src="'../../' + regression.diffImage" >
            </a>
          </td>
        </tr>
      </table>
    </div>
  </div>

</div>

<script>
  const state = {"regressions":{"Editor with sources__0.png":{"name":"Editor with sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with sources__0.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with sources__0.png","diffImage":"test-dist/screentest/diff/Editor with sources__0.png","isNew":false,"params":{"resolution":{"width":1000,"height":700},"nightMode":true},"isChanged":true},"Editor with sources__1.png":{"name":"Editor with sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with sources__1.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with sources__1.png","diffImage":"test-dist/screentest/diff/Editor with sources__1.png","isNew":false,"params":{"resolution":{"width":1500,"height":900},"nightMode":true},"isChanged":true},"Editor with sources__2.png":{"name":"Editor with sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with sources__2.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with sources__2.png","diffImage":"test-dist/screentest/diff/Editor with sources__2.png","isNew":false,"params":{"resolution":{"width":1000,"height":700},"nightMode":false},"isChanged":true},"Editor with sources__3.png":{"name":"Editor with sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with sources__3.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with sources__3.png","diffImage":"test-dist/screentest/diff/Editor with sources__3.png","isNew":false,"params":{"resolution":{"width":1500,"height":900},"nightMode":false},"isChanged":true},"Editor with the big amount of sources and scenes__0.png":{"name":"Editor with the big amount of sources and scenes","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with the big amount of sources and scenes__0.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with the big amount of sources and scenes__0.png","diffImage":"test-dist/screentest/diff/Editor with the big amount of sources and scenes__0.png","isNew":true,"params":{"resolution":{"width":1000,"height":700},"nightMode":true},"isChanged":false},"Editor with the big amount of sources and scenes__1.png":{"name":"Editor with the big amount of sources and scenes","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with the big amount of sources and scenes__1.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with the big amount of sources and scenes__1.png","diffImage":"test-dist/screentest/diff/Editor with the big amount of sources and scenes__1.png","isNew":true,"params":{"resolution":{"width":1500,"height":900},"nightMode":true},"isChanged":false},"Editor with the big amount of sources and scenes__2.png":{"name":"Editor with the big amount of sources and scenes","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with the big amount of sources and scenes__2.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with the big amount of sources and scenes__2.png","diffImage":"test-dist/screentest/diff/Editor with the big amount of sources and scenes__2.png","isNew":true,"params":{"resolution":{"width":1000,"height":700},"nightMode":false},"isChanged":false},"Editor with the big amount of sources and scenes__3.png":{"name":"Editor with the big amount of sources and scenes","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor with the big amount of sources and scenes__3.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor with the big amount of sources and scenes__3.png","diffImage":"test-dist/screentest/diff/Editor with the big amount of sources and scenes__3.png","isNew":true,"params":{"resolution":{"width":1500,"height":900},"nightMode":false},"isChanged":false},"Editor without sources__0.png":{"name":"Editor without sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor without sources__0.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor without sources__0.png","diffImage":"test-dist/screentest/diff/Editor without sources__0.png","isNew":false,"params":{"resolution":{"width":1000,"height":700},"nightMode":true},"isChanged":true},"Editor without sources__1.png":{"name":"Editor without sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor without sources__1.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor without sources__1.png","diffImage":"test-dist/screentest/diff/Editor without sources__1.png","isNew":false,"params":{"resolution":{"width":1500,"height":900},"nightMode":true},"isChanged":true},"Editor without sources__2.png":{"name":"Editor without sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor without sources__2.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor without sources__2.png","diffImage":"test-dist/screentest/diff/Editor without sources__2.png","isNew":false,"params":{"resolution":{"width":1000,"height":700},"nightMode":false},"isChanged":true},"Editor without sources__3.png":{"name":"Editor without sources","baseImage":"test-dist/screentest/regression_testing_screenshots_example/Editor without sources__3.png","branchImage":"test-dist/screentest/regression_testing_screenshots/Editor without sources__3.png","diffImage":"test-dist/screentest/diff/Editor without sources__3.png","isNew":false,"params":{"resolution":{"width":1500,"height":900},"nightMode":false},"isChanged":true}},"totalScreens":12,"changedScreens":8,"newScreens":4,"config":{"baseBranch":"regression_testing_screenshots_example","dist":"test-dist/screentest","configs":{"resolution":[{"width":1000,"height":700},{"width":1500,"height":900}],"nightMode":[true,false]}},"configs":[{"resolution":{"width":1000,"height":700},"nightMode":true},{"resolution":{"width":1500,"height":900},"nightMode":true},{"resolution":{"width":1000,"height":700},"nightMode":false},{"resolution":{"width":1500,"height":900},"nightMode":false}],"branches":["regression_testing_screenshots","regression_testing_screenshots_example"]}
  var app = new Vue({
    el: '#app',
    data() {

      const filters = {};

      Object.keys(state.config.configs).forEach(paramName => {
        const paramValues = state.config.configs[paramName];
        const filterValues = [];
        filterValues.length = paramValues.length;
        filterValues.fill(true);
        filters[paramName] = filterValues;
      });

      return {
        state,
        filters
      }
    },
    methods: {
      canShow(regression) {

        for (const paramName in regression.params) {
          const paramValue = regression.params[paramName];
          const configVariations = this.state.config.configs[paramName].options;
          for (let ind = 0; ind < configVariations.length; ind++ ) {
            if (
              JSON.stringify(paramValue) === JSON.stringify(configVariations[ind]) &&
              this.filters[paramName][ind] === false
            ) return false;
          }
        }

        return true;
      }
    }
  })

</script>
<style>


  body {
    background-color: darkgray;
    font-family: Verdana;
  }

  h3 {
    margin: 0;
    color: whitesmoke;
  }

  .filters {
    position: fixed;
    top:0;
    left: 0;
    width: 100%;
    background-color: #222222;
    border-bottom: 1px solid #555;
    color: #2faf93;
    font-family: "courier new", courier, monospace;
  }

  .filter {
    display: inline-block;
    padding: 5px;
  }

  .filters label {
    display: block;
  }

  .stats {
    position: absolute;
    top: 0;
    right: 15px;
    list-style: none;
    font-size: 12px;
  }

  .regressions {
    margin-top: 75px;
  }

  .regression {
    margin-bottom: 20px;
  }

  .regression img {
    display:block;
    width:100%;
    cursor: pointer;
  }

  span.new {
    background-color: #2faf93;
    color: white;
    border-radius: 3px;
    padding: 2px 4px;
  }

  .regression-new img {
    display: inline;
    width: auto;
  }
</style>

</body>
</html>